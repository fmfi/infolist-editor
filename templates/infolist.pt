<div tal:define="
     name name|field.name;
     style field.widget.style;
     oid oid|field.oid;
     css_class css_class|field.widget.css_class;"
     tal:omit-tag="">

  <input type="hidden" tal:attributes="
          name name;
          value cstruct;
          id oid;
          class string: form-control ${css_class or ''};
          data-placeholder field.widget.placeholder|None;">

  <script type="text/javascript">
    deform.addCallback(
      '${field.oid}',
      function(oid) {
        $('#' + oid).select2({
          containerCssClass: 'form-control',
          placeholder: "Vyhľadajte informačný list",
          minimumInputLength: 2,
          ajax: {
            url: "${search_url}",
            data: function (term, page) {
              return {
                q: term
              }
            },
            results: function (data, page) {
              var infolisty = $.map(data.infolisty, function(val) {
                return {id: val.id, text: val.skratka + " " + val.nazov_predmetu}
              });
              return {results: infolisty}
            }
          },
          initSelection: function(element, callback) {
            var id=$(element).val();
            if (id !== "") {
              $.ajax("${item_url}", {
                data: {id: id}
              }).done(function(data) { callback({id: data.id, text: data.skratka + " " + data.nazov_predmetu}); });
            }
          }
        });
      }
    );
  </script>
</div>

