<div tal:define="
     name name|field.name;
     style field.widget.style;
     oid oid|field.oid;
     css_class css_class|field.widget.css_class;"
     tal:omit-tag="">

  <input type="hidden" tal:attributes="
          name name;
          value cstruct;
          id oid;
          class string: form-control ${css_class or ''};
          data-placeholder field.widget.placeholder|None;">

  <script type="text/javascript">
    deform.addCallback(
      '${field.oid}',
      function(oid) {
        $('#' + oid).select2({
          containerCssClass: 'form-control',
          placeholder: "Vyhľadajte literatúru",
          minimumInputLength: 2,
          ajax: {
            url: "${search_url}",
            data: function (term, page) {
              return {
                q: term
              }
            },
            results: function (data, page) {
              return {results: data.literatura}
            }
          },
          initSelection: function(element, callback) {
            var id=$(element).val();
            if (id !== "") {
              $.ajax("${item_url}", {
                data: {id: id}
              }).done(function(data) { callback(data); });
            }
          },
          formatResult: function(object, container, query, escapeMarkup) {
            return "<strong>" + escapeMarkup(object.dokument) + "</strong><br/>" + 
              escapeMarkup(object.vyd_udaje);
          },
          formatSelection: function(object, container, escapeMarkup) {
            return escapeMarkup(object.dokument);
          }
        });
      }
    );
  </script>
</div>

